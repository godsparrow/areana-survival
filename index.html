<!DOCTYPE html>
<html>
<head>
<title>Large World Pixel Arena</title>
<style>
body { margin:0; background:black; overflow:hidden; }
canvas { display:block; margin:auto; image-rendering:pixelated; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 960;
canvas.height = 640;

const WORLD_SIZE = 7200;
const SPRITE_SIZE = 64;

let camera = { x:0, y:0 };

let keys = {};
document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

let player = {
    x: WORLD_SIZE/2,
    y: WORLD_SIZE/2,
    speed: 6,
    size: SPRITE_SIZE,
    fireRate: 20,
    cooldown: 0,
    bulletSpeed: 12,
    damage: 1,
    health: 100,
    angle: 0
};

let bullets = [];
let enemies = [];

function spawnEnemy(){
    enemies.push({
        x: Math.random()*WORLD_SIZE,
        y: Math.random()*WORLD_SIZE,
        size: SPRITE_SIZE,
        speed: 2,
        health: 5
    });
}
setInterval(spawnEnemy, 1500);

function shoot(target){
    let angle = Math.atan2(target.y-player.y,target.x-player.x);
    bullets.push({
        x:player.x,
        y:player.y,
        dx:Math.cos(angle)*player.bulletSpeed,
        dy:Math.sin(angle)*player.bulletSpeed,
        damage:player.damage
    });
    player.angle = angle;
}

function update(){

    // movement
    if(keys["w"]) player.y -= player.speed;
    if(keys["s"]) player.y += player.speed;
    if(keys["a"]) player.x -= player.speed;
    if(keys["d"]) player.x += player.speed;

    player.x = Math.max(0,Math.min(WORLD_SIZE,player.x));
    player.y = Math.max(0,Math.min(WORLD_SIZE,player.y));

    // camera follow
    camera.x = player.x - canvas.width/2;
    camera.y = player.y - canvas.height/2;

    camera.x = Math.max(0,Math.min(WORLD_SIZE-canvas.width,camera.x));
    camera.y = Math.max(0,Math.min(WORLD_SIZE-canvas.height,camera.y));

    // enemies
    enemies.forEach((e,ei)=>{
        let dx=player.x-e.x;
        let dy=player.y-e.y;
        let dist=Math.sqrt(dx*dx+dy*dy);

        e.x+=dx/dist*e.speed;
        e.y+=dy/dist*e.speed;

        if(dist<40){
            player.health-=0.2;
        }
    });

    // auto shoot
    let closest=null;
    let cd=Infinity;
    enemies.forEach(e=>{
        let dx=e.x-player.x;
        let dy=e.y-player.y;
        let dist=Math.sqrt(dx*dx+dy*dy);
        if(dist<cd){
            cd=dist;
            closest=e;
        }
    });

    if(closest && player.cooldown<=0){
        shoot(closest);
        player.cooldown=player.fireRate;
    }
    if(player.cooldown>0) player.cooldown--;

    // bullets
    bullets.forEach((b,bi)=>{
        b.x+=b.dx;
        b.y+=b.dy;

        enemies.forEach((e,ei)=>{
            let dx=e.x-b.x;
            let dy=e.y-b.y;
            if(Math.sqrt(dx*dx+dy*dy)<32){
                e.health-=b.damage;
                bullets.splice(bi,1);
                if(e.health<=0){
                    enemies.splice(ei,1);
                }
            }
        });
    });
}

function drawBackground(){
    ctx.fillStyle="#3b2f1c";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.strokeStyle="#2a2114";
    for(let x=0; x<WORLD_SIZE; x+=64){
        ctx.beginPath();
        ctx.moveTo(x-camera.x, -camera.y);
        ctx.lineTo(x-camera.x, WORLD_SIZE-camera.y);
        ctx.stroke();
    }
    for(let y=0; y<WORLD_SIZE; y+=64){
        ctx.beginPath();
        ctx.moveTo(-camera.x, y-camera.y);
        ctx.lineTo(WORLD_SIZE-camera.x, y-camera.y);
        ctx.stroke();
    }
}

function drawPlayer(){
    let px = player.x - camera.x;
    let py = player.y - camera.y;

    // 64x64 pixel sprite made of blocks
    ctx.fillStyle="#4a90e2";
    ctx.fillRect(px-24,py-32,48,48);

    ctx.fillStyle="#f1c27d";
    ctx.fillRect(px-16,py-48,32,16);
}

function drawEnemies(){
    enemies.forEach(e=>{
        let ex=e.x-camera.x;
        let ey=e.y-camera.y;

        ctx.fillStyle="#5aff5a";
        ctx.fillRect(ex-24,ey-24,48,48);
    });
}

function drawBullets(){
    ctx.fillStyle="yellow";
    bullets.forEach(b=>{
        ctx.fillRect(b.x-camera.x-4,b.y-camera.y-4,8,8);
    });
}

function drawUI(){
    ctx.fillStyle="white";
    ctx.font="20px monospace";
    ctx.fillText("HP: "+Math.floor(player.health),20,30);
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawBackground();
    drawPlayer();
    drawEnemies();
    drawBullets();
    drawUI();
}

function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
