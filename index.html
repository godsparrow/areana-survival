<!DOCTYPE html>
<html>
<head>
<title>Pixel Sword Survivor</title>
<style>
body {
    margin: 0;
    background: black;
    overflow: hidden;
}
canvas {
    display: block;
    margin: auto;
    background: #111;
    image-rendering: pixelated;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 900;
canvas.height = 600;

let player = {
    x: canvas.width/2,
    y: canvas.height/2,
    size: 28,
    speed: 4,
    slashRange: 90,
    damage: 1,
    cooldown: 0,
    angle: 0
};

let keys = {};
let enemies = [];
let score = 0;

document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

function spawnEnemy() {
    let side = Math.floor(Math.random()*4);
    let x, y;

    if (side === 0) { x = 0; y = Math.random()*canvas.height; }
    if (side === 1) { x = canvas.width; y = Math.random()*canvas.height; }
    if (side === 2) { x = Math.random()*canvas.width; y = 0; }
    if (side === 3) { x = Math.random()*canvas.width; y = canvas.height; }

    enemies.push({
        x: x,
        y: y,
        size: 26,
        speed: 1.5,
        health: 3
    });
}

setInterval(spawnEnemy, 1200);

function update() {

    // movement
    if (keys["w"]) player.y -= player.speed;
    if (keys["s"]) player.y += player.speed;
    if (keys["a"]) player.x -= player.speed;
    if (keys["d"]) player.x += player.speed;

    player.x = Math.max(0, Math.min(canvas.width, player.x));
    player.y = Math.max(0, Math.min(canvas.height, player.y));

    // enemy movement
    enemies.forEach(e => {
        let dx = player.x - e.x;
        let dy = player.y - e.y;
        let dist = Math.sqrt(dx*dx + dy*dy);

        e.x += dx/dist * e.speed;
        e.y += dy/dist * e.speed;
    });

    // find closest enemy
    let closest = null;
    let closestDist = Infinity;

    enemies.forEach(e => {
        let dx = e.x - player.x;
        let dy = e.y - player.y;
        let dist = Math.sqrt(dx*dx + dy*dy);

        if (dist < closestDist) {
            closestDist = dist;
            closest = e;
        }
    });

    // auto aim
    if (closest) {
        player.angle = Math.atan2(
            closest.y - player.y,
            closest.x - player.x
        );
    }

    // auto slash
    if (player.cooldown <= 0 && closest && closestDist < player.slashRange) {
        enemies.forEach((e,i) => {
            let dx = e.x - player.x;
            let dy = e.y - player.y;
            let dist = Math.sqrt(dx*dx + dy*dy);

            if (dist < player.slashRange) {
                e.health -= player.damage;
                if (e.health <= 0) {
                    enemies.splice(i,1);
                    score++;
                }
            }
        });

        player.cooldown = 25;
    }

    if (player.cooldown > 0) player.cooldown--;
}

function drawPixelPlayer() {
    ctx.fillStyle = "#00ffcc";
    ctx.fillRect(player.x-14, player.y-14, 28, 28);

    ctx.fillStyle = "#003333";
    ctx.fillRect(player.x-6, player.y-6, 12, 12);
}

function drawSword() {

    ctx.save();
    ctx.translate(player.x, player.y);
    ctx.rotate(player.angle);

    // blade
    ctx.fillStyle = "#dddddd";
    ctx.fillRect(20, -6, 60, 12);

    // blade tip
    ctx.fillStyle = "#bbbbbb";
    ctx.fillRect(75, -4, 10, 8);

    // guard
    ctx.fillStyle = "#ffaa00";
    ctx.fillRect(10, -12, 15, 24);

    // handle
    ctx.fillStyle = "#663300";
    ctx.fillRect(0, -5, 20, 10);

    ctx.restore();
}

function drawEnemies() {
    enemies.forEach(e => {
        ctx.fillStyle = "#ff3333";
        ctx.fillRect(e.x-13, e.y-13, 26, 26);

        ctx.fillStyle = "#550000";
        ctx.fillRect(e.x-5, e.y-5, 10, 10);
    });
}

function drawSlashEffect() {
    if (player.cooldown > 18) {
        ctx.strokeStyle = "white";
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.slashRange, 0, Math.PI*2);
        ctx.stroke();
    }
}

function drawUI() {
    ctx.fillStyle = "white";
    ctx.font = "20px monospace";
    ctx.fillText("Score: " + score, 20, 30);
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    drawSlashEffect();
    drawPixelPlayer();
    drawSword();
    drawEnemies();
    drawUI();
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
