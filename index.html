<!DOCTYPE html>
<html>
<head>
<title>Monster Arena</title>
<style>
body { margin:0; background:#111; overflow:hidden; }
canvas { display:block; image-rendering: pixelated; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 1280;
canvas.height = 720;

const WORLD_SIZE = 7200;
const ZOOM = 0.55;

let camera = {x:0,y:0};

let keys = {};
document.addEventListener("keydown", e=>keys[e.key]=true);
document.addEventListener("keyup", e=>keys[e.key]=false);

/* ================= PLAYER ================= */

let player = {
    x: WORLD_SIZE/2,
    y: WORLD_SIZE/2,
    size: 48,
    speed: 6,
    hp: 100,
    maxHp: 100,
    level: 1,
    exp: 0,
    nextLevel: 50,
    damage: 20,
    fireRate: 20,
    cooldown: 0
};

/* ================= ENEMIES ================= */

let enemies = [];
let wave = 1;

function spawnWave(){
    for(let i=0;i<wave*5;i++){
        let r=Math.random();
        if(r<0.5) enemies.push(createEnemy("slime"));
        else if(r<0.8) enemies.push(createEnemy("beast"));
        else enemies.push(createEnemy("demon"));
    }
}

function createEnemy(type){
    let base={
        x:Math.random()*WORLD_SIZE,
        y:Math.random()*WORLD_SIZE,
        size:48
    };

    if(type==="slime")
        return {...base,type,hp:40,speed:2,damage:5,exp:15};

    if(type==="beast")
        return {...base,type,hp:90,speed:3,damage:10,exp:35};

    if(type==="demon")
        return {...base,type,hp:160,speed:2.5,damage:20,exp:80};
}

spawnWave();

/* ================= AUTO AIM ================= */

let bullets=[];

function autoShoot(){

    if(player.cooldown>0) return;
    if(enemies.length===0) return;

    let closest=null;
    let closestDist=Infinity;

    for(let e of enemies){
        let dx=e.x-player.x;
        let dy=e.y-player.y;
        let dist=dx*dx+dy*dy;

        if(dist<closestDist){
            closestDist=dist;
            closest=e;
        }
    }

    if(closest){
        let angle=Math.atan2(
            closest.y-player.y,
            closest.x-player.x
        );

        bullets.push({
            x:player.x,
            y:player.y,
            dx:Math.cos(angle)*12,
            dy:Math.sin(angle)*12,
            life:120
        });

        player.cooldown=player.fireRate;
    }
}

/* ================= UPDATE ================= */

function update(){

    if(keys["w"]) player.y-=player.speed;
    if(keys["s"]) player.y+=player.speed;
    if(keys["a"]) player.x-=player.speed;
    if(keys["d"]) player.x+=player.speed;

    player.x=Math.max(0,Math.min(WORLD_SIZE,player.x));
    player.y=Math.max(0,Math.min(WORLD_SIZE,player.y));

    camera.x=player.x-(canvas.width/(2*ZOOM));
    camera.y=player.y-(canvas.height/(2*ZOOM));

    if(player.cooldown>0) player.cooldown--;

    autoShoot();

    // bullets
    for(let i=bullets.length-1;i>=0;i--){
        let b=bullets[i];
        b.x+=b.dx;
        b.y+=b.dy;
        b.life--;

        for(let j=enemies.length-1;j>=0;j--){
            let e=enemies[j];
            if(Math.abs(b.x-e.x)<24 && Math.abs(b.y-e.y)<24){
                e.hp-=player.damage;
                bullets.splice(i,1);
                if(e.hp<=0){
                    player.exp+=e.exp;
                    enemies.splice(j,1);
                }
                break;
            }
        }

        if(b.life<=0) bullets.splice(i,1);
    }

    // enemies chase
    for(let e of enemies){
        let dx=player.x-e.x;
        let dy=player.y-e.y;
        let dist=Math.sqrt(dx*dx+dy*dy);
        e.x+=dx/dist*e.speed;
        e.y+=dy/dist*e.speed;

        if(dist<30) player.hp-=e.damage*0.05;
    }

    if(enemies.length===0){
        wave++;
        spawnWave();
    }

    if(player.exp>=player.nextLevel){
        player.exp=0;
        player.level++;
        player.nextLevel+=50;
        player.maxHp+=20;
        player.hp=player.maxHp;
        player.damage+=5;
        player.fireRate=Math.max(5,player.fireRate-2);
    }
}

/* ================= SPRITES ================= */

function drawPlayer(x,y){

    // legs
    ctx.fillStyle="#3a3a3a";
    ctx.fillRect(x+14,y+28,8,20);
    ctx.fillRect(x+26,y+28,8,20);

    // torso armor
    ctx.fillStyle="#2c5aa0";
    ctx.fillRect(x+10,y+12,28,20);

    ctx.fillStyle="#4f82d6";
    ctx.fillRect(x+14,y+16,20,12);

    // head
    ctx.fillStyle="#f1c27d";
    ctx.fillRect(x+14,y,20,14);

    // hair
    ctx.fillStyle="#4b2e19";
    ctx.fillRect(x+14,y,20,6);

    // eyes
    ctx.fillStyle="black";
    ctx.fillRect(x+18,y+6,3,3);
    ctx.fillRect(x+26,y+6,3,3);
}

function drawEnemy(e,x,y){

    if(e.type==="slime"){
        ctx.fillStyle="#2faa32";
        ctx.fillRect(x,y+12,48,30);
        ctx.fillStyle="#58ff6a";
        ctx.fillRect(x+8,y+18,32,18);
        ctx.fillStyle="black";
        ctx.fillRect(x+16,y+22,4,4);
        ctx.fillRect(x+28,y+22,4,4);
    }

    if(e.type==="beast"){
        ctx.fillStyle="#6b3f1d";
        ctx.fillRect(x+6,y+14,36,24);
        ctx.fillStyle="#8c5428";
        ctx.fillRect(x+12,y+18,24,14);
        ctx.fillStyle="#fff";
        ctx.fillRect(x+16,y+10,6,6);
        ctx.fillRect(x+26,y+10,6,6);
        ctx.fillStyle="black";
        ctx.fillRect(x+18,y+12,2,2);
        ctx.fillRect(x+28,y+12,2,2);
    }

    if(e.type==="demon"){
        ctx.fillStyle="#7b1e1e";
        ctx.fillRect(x+10,y+14,28,24);
        ctx.fillStyle="#ff3b3b";
        ctx.fillRect(x+16,y+18,16,14);
        ctx.fillStyle="#ffaaaa";
        ctx.fillRect(x+18,y+6,4,8);
        ctx.fillRect(x+26,y+6,4,8);
        ctx.fillStyle="yellow";
        ctx.fillRect(x+18,y+20,4,4);
        ctx.fillRect(x+26,y+20,4,4);
    }
}

/* ================= DRAW ================= */

function draw(){

    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.save();
    ctx.scale(ZOOM,ZOOM);
    ctx.translate(-camera.x,-camera.y);

    // textured ground
    for(let x=0;x<WORLD_SIZE;x+=128){
        for(let y=0;y<WORLD_SIZE;y+=128){
            ctx.fillStyle=((x+y)/128)%2===0?"#2a2a2a":"#262626";
            ctx.fillRect(x,y,128,128);

            ctx.fillStyle="#1e1e1e";
            ctx.fillRect(x+8,y+8,4,4);
        }
    }

    for(let e of enemies){
        drawEnemy(e,e.x,e.y);
    }

    ctx.fillStyle="yellow";
    for(let b of bullets){
        ctx.fillRect(b.x,b.y,6,6);
    }

    drawPlayer(player.x,player.y);

    ctx.restore();

    // HP BAR (GREEN)
    ctx.fillStyle="red";
    ctx.fillRect(20,20,300,20);
    ctx.fillStyle="lime";
    ctx.fillRect(20,20,300*(player.hp/player.maxHp),20);

    // EXP BAR (BLUE)
    ctx.fillStyle="#222";
    ctx.fillRect(20,50,300,15);
    ctx.fillStyle="blue";
    ctx.fillRect(20,50,300*(player.exp/player.nextLevel),15);

    ctx.fillStyle="white";
    ctx.fillText("Level "+player.level,20,85);
    ctx.fillText("Wave "+wave,20,105);
}

function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
