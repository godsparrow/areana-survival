<!DOCTYPE html>
<html>
<head>
<title>Auto Shooter Level System</title>
<style>
body { margin:0; background:black; overflow:hidden; }
canvas { display:block; margin:auto; background:#111; image-rendering:pixelated; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 900;
canvas.height = 600;

let keys = {};
document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

let player = {
    x: canvas.width/2,
    y: canvas.height/2,
    size: 28,
    speed: 4,
    fireRate: 20,
    cooldown: 0,
    bulletSpeed: 8,
    damage: 1,
    health: 100,
    maxHealth: 100,
    angle: 0,
    level: 1,
    xp: 0,
    xpNeeded: 20
};

let bullets = [];
let enemies = [];
let gamePaused = false;
let levelChoices = [];

function spawnEnemy() {
    let side = Math.floor(Math.random()*4);
    let x,y;

    if(side===0){ x=0; y=Math.random()*canvas.height; }
    if(side===1){ x=canvas.width; y=Math.random()*canvas.height; }
    if(side===2){ x=Math.random()*canvas.width; y=0; }
    if(side===3){ x=Math.random()*canvas.width; y=canvas.height; }

    enemies.push({
        x,y,
        size: 26,
        speed: 1.5 + player.level*0.1,
        health: 3 + player.level,
        xpValue: 5
    });
}

setInterval(spawnEnemy, 1200);

function shoot(target){
    let angle = Math.atan2(target.y-player.y,target.x-player.x);

    bullets.push({
        x: player.x,
        y: player.y,
        dx: Math.cos(angle)*player.bulletSpeed,
        dy: Math.sin(angle)*player.bulletSpeed,
        size:6,
        damage: player.damage
    });

    player.angle = angle;
}

function levelUp(){
    gamePaused = true;
    player.level++;
    player.xp = 0;
    player.xpNeeded += 15;

    levelChoices = [
        "Damage Up",
        "Fire Rate Up",
        "Bullet Speed Up",
        "Speed Up",
        "Max Health Up"
    ];
}

function applyUpgrade(choice){
    if(choice === "Damage Up") player.damage++;
    if(choice === "Fire Rate Up") player.fireRate = Math.max(5, player.fireRate-3);
    if(choice === "Bullet Speed Up") player.bulletSpeed+=2;
    if(choice === "Speed Up") player.speed+=0.5;
    if(choice === "Max Health Up"){
        player.maxHealth+=20;
        player.health+=20;
    }

    gamePaused = false;
}

canvas.addEventListener("click", e=>{
    if(!gamePaused) return;

    let rect = canvas.getBoundingClientRect();
    let mx = e.clientX - rect.left;
    let my = e.clientY - rect.top;

    levelChoices.forEach((choice,i)=>{
        let y = 200 + i*60;
        if(mx > 300 && mx < 600 && my > y-20 && my < y+20){
            applyUpgrade(choice);
        }
    });
});

function update(){
    if(gamePaused) return;

    // movement
    if(keys["w"]) player.y -= player.speed;
    if(keys["s"]) player.y += player.speed;
    if(keys["a"]) player.x -= player.speed;
    if(keys["d"]) player.x += player.speed;

    player.x = Math.max(0,Math.min(canvas.width,player.x));
    player.y = Math.max(0,Math.min(canvas.height,player.y));

    // enemies
    enemies.forEach(e=>{
        let dx = player.x-e.x;
        let dy = player.y-e.y;
        let dist = Math.sqrt(dx*dx+dy*dy);
        e.x += dx/dist*e.speed;
        e.y += dy/dist*e.speed;

        if(dist < 20){
            player.health -= 0.2;
        }
    });

    // closest
    let closest=null;
    let closestDist=Infinity;

    enemies.forEach(e=>{
        let dx=e.x-player.x;
        let dy=e.y-player.y;
        let dist=Math.sqrt(dx*dx+dy*dy);
        if(dist<closestDist){
            closestDist=dist;
            closest=e;
        }
    });

    if(closest && player.cooldown<=0){
        shoot(closest);
        player.cooldown = player.fireRate;
    }

    if(player.cooldown>0) player.cooldown--;

    bullets.forEach((b,bi)=>{
        b.x+=b.dx;
        b.y+=b.dy;

        if(b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height){
            bullets.splice(bi,1);
        }

        enemies.forEach((e,ei)=>{
            let dx=e.x-b.x;
            let dy=e.y-b.y;
            let dist=Math.sqrt(dx*dx+dy*dy);

            if(dist < e.size/2){
                e.health -= b.damage;
                bullets.splice(bi,1);

                if(e.health<=0){
                    player.xp += e.xpValue;
                    enemies.splice(ei,1);

                    if(player.xp >= player.xpNeeded){
                        levelUp();
                    }
                }
            }
        });
    });

    if(player.health<=0){
        alert("Game Over");
        location.reload();
    }
}

function drawUI(){
    ctx.fillStyle="white";
    ctx.font="18px monospace";
    ctx.fillText("HP: "+Math.floor(player.health)+"/"+player.maxHealth,20,30);
    ctx.fillText("Level: "+player.level,20,55);

    // XP bar
    ctx.fillStyle="gray";
    ctx.fillRect(20,70,200,15);
    ctx.fillStyle="lime";
    ctx.fillRect(20,70,(player.xp/player.xpNeeded)*200,15);
}

function drawLevelMenu(){
    ctx.fillStyle="rgba(0,0,0,0.8)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle="white";
    ctx.font="30px monospace";
    ctx.fillText("LEVEL UP!",350,120);

    ctx.font="20px monospace";
    levelChoices.forEach((choice,i)=>{
        let y = 200 + i*60;
        ctx.fillStyle="white";
        ctx.fillRect(300,y-20,300,40);
        ctx.fillStyle="black";
        ctx.fillText(choice,350,y+5);
    });
}

function drawPlayer(){
    ctx.fillStyle="#00ffcc";
    ctx.fillRect(player.x-14,player.y-14,28,28);

    ctx.save();
    ctx.translate(player.x,player.y);
    ctx.rotate(player.angle);
    ctx.fillStyle="#aaa";
    ctx.fillRect(14,-4,18,8);
    ctx.restore();
}

function drawEnemies(){
    enemies.forEach(e=>{
        ctx.fillStyle="red";
        ctx.fillRect(e.x-13,e.y-13,26,26);
    });
}

function drawBullets(){
    ctx.fillStyle="yellow";
    bullets.forEach(b=>{
        ctx.fillRect(b.x-3,b.y-3,6,6);
    });
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawPlayer();
    drawEnemies();
    drawBullets();
    drawUI();

    if(gamePaused) drawLevelMenu();
}

function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
