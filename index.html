<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Arcane Fields</title>
<style>
body { margin:0; overflow:hidden; background:#0c0f1a; font-family:monospace; }
canvas { display:block; }

#ui {
 position:absolute;
 top:10px;
 left:50%;
 transform:translateX(-50%);
 width:400px;
}

.bar {
 height:18px;
 background:#222;
 margin-bottom:6px;
 border:2px solid #000;
}

#hpFill { height:100%; background:#00cc44; width:100%; }
#expFill { height:100%; background:#0066ff; width:0%; }

#statMenu, #mainMenu {
 position:absolute;
 top:50%;
 left:50%;
 transform:translate(-50%,-50%);
 background:#1a1f2e;
 padding:20px;
 border:4px solid #3a4a7a;
 display:none;
 color:white;
 width:300px;
}

button {
 background:#2a3a6a;
 color:white;
 border:none;
 padding:8px;
 margin:5px 0;
 width:100%;
 cursor:pointer;
}
button:hover { background:#3f5bb5; }

#title {
 font-size:32px;
 text-align:center;
 margin-bottom:20px;
 animation:pulse 2s infinite alternate;
}
@keyframes pulse {
 from { text-shadow:0 0 10px #4488ff; }
 to { text-shadow:0 0 25px #88ccff; }
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="ui">
 <div class="bar"><div id="hpFill"></div></div>
 <div class="bar"><div id="expFill"></div></div>
</div>

<div id="mainMenu">
 <div id="title">ARCANE FIELDS</div>
 <button onclick="startGame()">Start Game</button>
</div>

<div id="statMenu">
 <h3>Level Up! (Points: <span id="points">0</span>)</h3>
 <button onclick="upgrade('damage')">Damage (<span id="dmgStat">1</span>)</button>
 <button onclick="upgrade('speed')">Speed (<span id="spdStat">2</span>)</button>
 <button onclick="upgrade('rate')">Fire Rate (<span id="rateStat">600</span>)</button>
 <button onclick="closeStats()">Resume</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gameRunning=false;
let paused=false;

let player, enemies=[], bullets=[], particles=[];
let keys={};
let wave=1;
let expToLevel=50;

document.getElementById("mainMenu").style.display="block";

function startGame(){
 document.getElementById("mainMenu").style.display="none";
 gameRunning=true;
 init();
 loop();
}

function init(){
 player={
  x:0,y:0,
  size:24,
  hp:100,maxHp:100,
  exp:0,level:1,points:0,
  damage:10,speed:2.5,fireRate:600,
  lastShot:0,anim:0
 };
 spawnWave();
}

function spawnWave(){
 for(let i=0;i<wave*5;i++){
  enemies.push({
   x:(Math.random()-0.5)*1500,
   y:(Math.random()-0.5)*1500,
   size:22,
   hp:30+wave*10,
   maxHp:30+wave*10,
   speed:1+wave*0.1,
   exp:10+wave*5
  });
 }
}

function loop(){
 if(!gameRunning)return;
 requestAnimationFrame(loop);
 if(paused)return;
 update();
 draw();
}

function update(){
 player.anim+=0.1;

 if(keys["w"]) player.y-=player.speed;
 if(keys["s"]) player.y+=player.speed;
 if(keys["a"]) player.x-=player.speed;
 if(keys["d"]) player.x+=player.speed;

 autoAim();

 enemies.forEach(e=>{
  let dx=player.x-e.x;
  let dy=player.y-e.y;
  let dist=Math.hypot(dx,dy);
  e.x+=dx/dist*e.speed;
  e.y+=dy/dist*e.speed;

  if(dist<20){
   player.hp-=0.2;
   if(player.hp<=0) alert("Game Over");
  }
 });

 bullets.forEach(b=>{
  b.x+=b.dx;
  b.y+=b.dy;

  enemies.forEach(e=>{
   if(Math.hypot(b.x-e.x,b.y-e.y)<e.size){
    e.hp-=player.damage;
    b.dead=true;
    if(e.hp<=0){
     player.exp+=e.exp;
     enemies.splice(enemies.indexOf(e),1);
     if(enemies.length===0){
      wave++;
      spawnWave();
     }
    }
   }
  });

  particles.push({x:b.x,y:b.y,life:20});
 });

 bullets=bullets.filter(b=>!b.dead);

 particles.forEach(p=>p.life--);
 particles=particles.filter(p=>p.life>0);

 if(player.exp>=expToLevel){
  player.exp-=expToLevel;
  player.level++;
  player.points+=3;
  expToLevel+=30;
  openStats();
 }

 document.getElementById("hpFill").style.width=(player.hp/player.maxHp*100)+"%";
 document.getElementById("expFill").style.width=(player.exp/expToLevel*100)+"%";
}

function autoAim(){
 if(Date.now()-player.lastShot<player.fireRate)return;
 if(enemies.length===0)return;

 let closest=enemies.reduce((a,b)=>{
  return Math.hypot(player.x-a.x,player.y-a.y) <
         Math.hypot(player.x-b.x,player.y-b.y)?a:b;
 });

 let dx=closest.x-player.x;
 let dy=closest.y-player.y;
 let dist=Math.hypot(dx,dy);

 bullets.push({
  x:player.x,
  y:player.y,
  dx:dx/dist*6,
  dy:dy/dist*6
 });

 player.lastShot=Date.now();
}

function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 ctx.save();
 ctx.translate(canvas.width/2-player.x,
               canvas.height/2-player.y);

 drawBackground();

 particles.forEach(p=>{
  ctx.fillStyle="rgba(100,150,255,"+(p.life/20)+")";
  ctx.fillRect(p.x,p.y,4,4);
 });

 bullets.forEach(b=>{
  ctx.fillStyle="#66ccff";
  ctx.beginPath();
  ctx.arc(b.x,b.y,6,0,Math.PI*2);
  ctx.fill();
 });

 enemies.forEach(e=>{
  ctx.fillStyle="#663300";
  ctx.fillRect(e.x-10,e.y-10,20,20);

  ctx.fillStyle="red";
  ctx.fillRect(e.x-10,e.y-16,20*(e.hp/e.maxHp),4);
 });

 drawPlayer();

 ctx.restore();
}

function drawPlayer(){
 let walk=Math.sin(player.anim)*2;

 ctx.fillStyle="#ffccaa";
 ctx.fillRect(player.x-6,player.y-16+walk,12,12);

 ctx.fillStyle="#3333aa";
 ctx.fillRect(player.x-8,player.y-4+walk,16,18);

 ctx.fillStyle="#5522ff";
 ctx.fillRect(player.x+8,player.y-8,14,4);
}

function drawBackground(){
 for(let x=-2000;x<2000;x+=64){
  for(let y=-2000;y<2000;y+=64){
   ctx.fillStyle=(x+y)%128==0?"#1a253f":"#152033";
   ctx.fillRect(x,y,64,64);
  }
 }
}

function openStats(){
 paused=true;
 document.getElementById("statMenu").style.display="block";
 updateStatUI();
}

function closeStats(){
 paused=false;
 document.getElementById("statMenu").style.display="none";
}

function upgrade(stat){
 if(player.points<=0)return;

 if(stat==="damage") player.damage+=5;
 if(stat==="speed") player.speed+=0.5;
 if(stat==="rate") player.fireRate-=50;

 player.points--;
 updateStatUI();
}

function updateStatUI(){
 document.getElementById("points").innerText=player.points;
 document.getElementById("dmgStat").innerText=player.damage;
 document.getElementById("spdStat").innerText=player.speed.toFixed(1);
 document.getElementById("rateStat").innerText=player.fireRate;
}

window.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
window.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

</script>
</body>
</html>
