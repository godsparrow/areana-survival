<!DOCTYPE html>
<html>
<head>
<title>Pixel Shooter Survivor</title>
<style>
body {
    margin: 0;
    background: black;
    overflow: hidden;
}
canvas {
    display: block;
    margin: auto;
    background: #111;
    image-rendering: pixelated;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 900;
canvas.height = 600;

let player = {
    x: canvas.width/2,
    y: canvas.height/2,
    size: 28,
    speed: 4,
    shootCooldown: 0,
    angle: 0
};

let keys = {};
let enemies = [];
let bullets = [];
let score = 0;

document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

function spawnEnemy() {
    let side = Math.floor(Math.random()*4);
    let x, y;

    if (side === 0) { x = 0; y = Math.random()*canvas.height; }
    if (side === 1) { x = canvas.width; y = Math.random()*canvas.height; }
    if (side === 2) { x = Math.random()*canvas.width; y = 0; }
    if (side === 3) { x = Math.random()*canvas.width; y = canvas.height; }

    enemies.push({
        x: x,
        y: y,
        size: 26,
        speed: 1.5,
        health: 3
    });
}

setInterval(spawnEnemy, 1000);

function shoot(target) {
    let angle = Math.atan2(target.y - player.y, target.x - player.x);

    bullets.push({
        x: player.x,
        y: player.y,
        dx: Math.cos(angle) * 8,
        dy: Math.sin(angle) * 8,
        size: 6
    });

    player.angle = angle;
}

function update() {

    // Movement
    if (keys["w"]) player.y -= player.speed;
    if (keys["s"]) player.y += player.speed;
    if (keys["a"]) player.x -= player.speed;
    if (keys["d"]) player.x += player.speed;

    player.x = Math.max(0, Math.min(canvas.width, player.x));
    player.y = Math.max(0, Math.min(canvas.height, player.y));

    // Move enemies
    enemies.forEach(e => {
        let dx = player.x - e.x;
        let dy = player.y - e.y;
        let dist = Math.sqrt(dx*dx + dy*dy);
        e.x += dx/dist * e.speed;
        e.y += dy/dist * e.speed;
    });

    // Find closest enemy
    let closest = null;
    let closestDist = Infinity;

    enemies.forEach(e => {
        let dx = e.x - player.x;
        let dy = e.y - player.y;
        let dist = Math.sqrt(dx*dx + dy*dy);

        if (dist < closestDist) {
            closestDist = dist;
            closest = e;
        }
    });

    // Auto shoot (no range limit)
    if (closest && player.shootCooldown <= 0) {
        shoot(closest);
        player.shootCooldown = 20; // fire rate
    }

    if (player.shootCooldown > 0) player.shootCooldown--;

    // Move bullets
    bullets.forEach((b, bi) => {
        b.x += b.dx;
        b.y += b.dy;

        // Remove off screen
        if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
            bullets.splice(bi,1);
        }

        // Collision
        enemies.forEach((e, ei) => {
            let dx = e.x - b.x;
            let dy = e.y - b.y;
            let dist = Math.sqrt(dx*dx + dy*dy);

            if (dist < e.size/2) {
                e.health -= 1;
                bullets.splice(bi,1);

                if (e.health <= 0) {
                    enemies.splice(ei,1);
                    score++;
                }
            }
        });
    });
}

function drawPlayer() {
    ctx.fillStyle = "#00ffcc";
    ctx.fillRect(player.x-14, player.y-14, 28, 28);

    ctx.fillStyle = "#003333";
    ctx.fillRect(player.x-6, player.y-6, 12, 12);

    // Gun barrel
    ctx.save();
    ctx.translate(player.x, player.y);
    ctx.rotate(player.angle);
    ctx.fillStyle = "#aaaaaa";
    ctx.fillRect(14, -4, 16, 8);
    ctx.restore();
}

function drawEnemies() {
    enemies.forEach(e => {
        ctx.fillStyle = "#ff3333";
        ctx.fillRect(e.x-13, e.y-13, 26, 26);

        ctx.fillStyle = "#550000";
        ctx.fillRect(e.x-5, e.y-5, 10, 10);
    });
}

function drawBullets() {
    ctx.fillStyle = "yellow";
    bullets.forEach(b => {
        ctx.fillRect(b.x-3, b.y-3, 6, 6);
    });
}

function drawUI() {
    ctx.fillStyle = "white";
    ctx.font = "20px monospace";
    ctx.fillText("Score: " + score, 20, 30);
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawPlayer();
    drawEnemies();
    drawBullets();
    drawUI();
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
