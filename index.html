<!DOCTYPE html>
<html>
<head>
<title>Arcane Arena</title>
<style>
body { margin:0; background:black; overflow:hidden; }
canvas { display:block; image-rendering: pixelated; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 1280;
canvas.height = 720;

const WORLD_SIZE = 7200;
const ZOOM = 0.65;

let gameState = "menu";
let camera = {x:0,y:0};

/* ================= INPUT ================= */

let keys = {};
document.addEventListener("keydown", e=>{
    keys[e.key]=true;

    if(gameState==="menu" && e.key==="Enter") startGame();

    if(gameState==="game" && e.key==="p") gameState="stats";
    else if(gameState==="stats" && e.key==="p") gameState="game";

    if(gameState==="stats") spendStat(e.key);
});
document.addEventListener("keyup", e=>keys[e.key]=false);

/* ================= PLAYER ================= */

let player;

function createPlayer(){
return {
    x: WORLD_SIZE/2,
    y: WORLD_SIZE/2,
    speed: 5,
    hp: 100,
    maxHp: 100,
    level: 1,
    exp: 0,
    nextLevel: 50,
    damage: 20,
    fireRate: 25,
    cooldown: 0,
    statPoints: 0,
    walk: 0,
    casting: 0
};
}

/* ================= ENEMIES ================= */

let enemies=[];
let wave=1;

function spawnWave(){
    for(let i=0;i<wave*5;i++){
        let r=Math.random();
        if(r<0.4) enemies.push(makeEnemy("slime"));
        else if(r<0.7) enemies.push(makeEnemy("beast"));
        else if(r<0.9) enemies.push(makeEnemy("ghost"));
        else enemies.push(makeEnemy("demon"));
    }
}

function makeEnemy(type){
    return {
        x:Math.random()*WORLD_SIZE,
        y:Math.random()*WORLD_SIZE,
        type,
        anim:0,
        hp: type==="slime"?40:
            type==="beast"?90:
            type==="ghost"?70:160,
        speed: type==="ghost"?4:
               type==="beast"?3:
               type==="demon"?2.5:2,
        damage:10,
        exp: type==="slime"?15:
             type==="beast"?35:
             type==="ghost"?40:80
    };
}

/* ================= MAGIC ================= */

let bullets=[];
let particles=[];

function autoShoot(){

    if(player.cooldown>0 || enemies.length===0) return;

    let closest=null;
    let best=Infinity;

    for(let e of enemies){
        let dx=e.x-player.x;
        let dy=e.y-player.y;
        let d=dx*dx+dy*dy;
        if(d<best){best=d; closest=e;}
    }

    if(closest){
        let angle=Math.atan2(
            closest.y-player.y,
            closest.x-player.x
        );

        bullets.push({
            x:player.x,
            y:player.y,
            dx:Math.cos(angle)*10,
            dy:Math.sin(angle)*10,
            life:100
        });

        player.cooldown=player.fireRate;
        player.casting=12;
    }
}

/* ================= STAT SYSTEM ================= */

function spendStat(k){
if(player.statPoints<=0) return;

if(k==="1"){ player.maxHp+=20; player.hp=player.maxHp; player.statPoints--; }
if(k==="2"){ player.damage+=5; player.statPoints--; }
if(k==="3"){ player.speed+=1; player.statPoints--; }
if(k==="4"){ player.fireRate=Math.max(5,player.fireRate-3); player.statPoints--; }
}

/* ================= UPDATE ================= */

function update(){

if(gameState!=="game") return;

let moving=false;

if(keys["w"]){player.y-=player.speed; moving=true;}
if(keys["s"]){player.y+=player.speed; moving=true;}
if(keys["a"]){player.x-=player.speed; moving=true;}
if(keys["d"]){player.x+=player.speed; moving=true;}

if(moving) player.walk+=0.2;

camera.x=player.x-(canvas.width/(2*ZOOM));
camera.y=player.y-(canvas.height/(2*ZOOM));

if(player.cooldown>0) player.cooldown--;
if(player.casting>0) player.casting--;

autoShoot();

/* bullets */
for(let i=bullets.length-1;i>=0;i--){
    let b=bullets[i];
    b.x+=b.dx;
    b.y+=b.dy;
    b.life--;

    particles.push({x:b.x,y:b.y,life:20});

    for(let j=enemies.length-1;j>=0;j--){
        let e=enemies[j];
        if(Math.abs(b.x-e.x)<25 && Math.abs(b.y-e.y)<25){
            e.hp-=player.damage;
            bullets.splice(i,1);
            if(e.hp<=0){
                player.exp+=e.exp;
                enemies.splice(j,1);
            }
            break;
        }
    }

    if(b.life<=0) bullets.splice(i,1);
}

/* particles */
for(let i=particles.length-1;i>=0;i--){
    particles[i].life--;
    if(particles[i].life<=0) particles.splice(i,1);
}

/* enemies */
for(let e of enemies){
    let dx=player.x-e.x;
    let dy=player.y-e.y;
    let dist=Math.sqrt(dx*dx+dy*dy);
    e.x+=dx/dist*e.speed;
    e.y+=dy/dist*e.speed;
    e.anim+=0.1;

    if(dist<30) player.hp-=0.1;
}

if(enemies.length===0){
    wave++;
    spawnWave();
}

if(player.exp>=player.nextLevel){
    player.exp=0;
    player.level++;
    player.nextLevel+=50;
    player.statPoints+=3;
}
}

/* ================= DRAW ================= */

function drawPlayer(x,y){

let legSwing=Math.sin(player.walk)*4;
let castLift=player.casting>0?-6:0;

/* legs */
ctx.fillStyle="#444";
ctx.fillRect(x+12,y+30+legSwing,8,18);
ctx.fillRect(x+24,y+30-legSwing,8,18);

/* robe */
ctx.fillStyle="#2c5aa0";
ctx.fillRect(x+10,y+12,28,22);

/* belt */
ctx.fillStyle="#1b3a6b";
ctx.fillRect(x+10,y+26,28,4);

/* head */
ctx.fillStyle="#f1c27d";
ctx.fillRect(x+14,y,20,14);

/* hair */
ctx.fillStyle="#4b2e19";
ctx.fillRect(x+14,y,20,6);

/* eyes */
ctx.fillStyle="black";
ctx.fillRect(x+18,y+6,3,3);
ctx.fillRect(x+26,y+6,3,3);

/* staff */
ctx.fillStyle="#8b5a2b";
ctx.fillRect(x+36,y+10+castLift,4,30);

ctx.fillStyle="#00ccff";
ctx.fillRect(x+32,y+4+castLift,12,8);
}

function drawEnemy(e,x,y){

let bounce=Math.sin(e.anim)*3;

if(e.type==="slime"){
    ctx.fillStyle="#3cff5a";
    ctx.fillRect(x,y+20+bounce,40,20);
}

if(e.type==="beast"){
    ctx.fillStyle="#6b3f1d";
    ctx.fillRect(x,y+18+bounce,44,22);
    ctx.fillStyle="white";
    ctx.fillRect(x+10,y+12+bounce,6,6);
    ctx.fillRect(x+26,y+12+bounce,6,6);
}

if(e.type==="ghost"){
    ctx.fillStyle="rgba(200,200,255,0.8)";
    ctx.fillRect(x,y+12+bounce,40,28);
}

if(e.type==="demon"){
    ctx.fillStyle="#aa0000";
    ctx.fillRect(x,y+14+bounce,40,24);
    ctx.fillStyle="yellow";
    ctx.fillRect(x+12,y+18+bounce,4,4);
    ctx.fillRect(x+24,y+18+bounce,4,4);
}
}

function drawMenu(){
ctx.fillStyle="black";
ctx.fillRect(0,0,canvas.width,canvas.height);

let pulse=Math.sin(Date.now()*0.003)*10;

ctx.fillStyle="#00ccff";
ctx.font="60px Arial";
ctx.fillText("ARCANE ARENA",350,280+pulse);

ctx.font="24px Arial";
ctx.fillStyle="white";
ctx.fillText("Press ENTER to Begin",480,400);
}

function drawStats(){
ctx.fillStyle="rgba(0,0,0,0.85)";
ctx.fillRect(350,120,580,480);

ctx.fillStyle="white";
ctx.font="28px Arial";
ctx.fillText("STAT MENU",560,170);

ctx.font="20px Arial";
ctx.fillText("Points: "+player.statPoints,550,210);

ctx.fillText("1 - Max HP: "+player.maxHp,450,260);
ctx.fillText("2 - Damage: "+player.damage,450,300);
ctx.fillText("3 - Speed: "+player.speed,450,340);
ctx.fillText("4 - Cast Speed: "+(25-player.fireRate),450,380);

ctx.fillText("Press P to Resume",520,450);
}

function drawGame(){

ctx.clearRect(0,0,canvas.width,canvas.height);

ctx.save();
ctx.scale(ZOOM,ZOOM);
ctx.translate(-camera.x,-camera.y);

/* ground */
for(let x=0;x<WORLD_SIZE;x+=128){
    for(let y=0;y<WORLD_SIZE;y+=128){
        ctx.fillStyle=((x+y)/128)%2?"#2a2a2a":"#242424";
        ctx.fillRect(x,y,128,128);
    }
}

for(let e of enemies) drawEnemy(e,e.x,e.y);

ctx.fillStyle="#00ffff";
for(let b of bullets) ctx.fillRect(b.x,b.y,6,6);

for(let p of particles){
    ctx.globalAlpha=p.life/20;
    ctx.fillStyle="#00aaff";
    ctx.fillRect(p.x,p.y,4,4);
    ctx.globalAlpha=1;
}

drawPlayer(player.x,player.y);

ctx.restore();

/* UI */
ctx.fillStyle="red";
ctx.fillRect(20,20,300,20);
ctx.fillStyle="lime";
ctx.fillRect(20,20,300*(player.hp/player.maxHp),20);

ctx.fillStyle="#222";
ctx.fillRect(20,50,300,15);
ctx.fillStyle="blue";
ctx.fillRect(20,50,300*(player.exp/player.nextLevel),15);

ctx.fillStyle="white";
ctx.fillText("Level "+player.level,20,85);
ctx.fillText("Wave "+wave,20,105);
}

function draw(){
if(gameState==="menu") drawMenu();
if(gameState==="game") drawGame();
if(gameState==="stats"){ drawGame(); drawStats(); }
}

function startGame(){
player=createPlayer();
enemies=[];
bullets=[];
particles=[];
wave=1;
spawnWave();
gameState="game";
}

function loop(){
update();
draw();
requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
