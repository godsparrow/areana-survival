<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pixel Slash Arena</title>
<style>
body {
    margin: 0;
    background: #1b1b1b;
    overflow: hidden;
}
canvas {
    display: block;
    margin: auto;
    image-rendering: pixelated;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 800;
canvas.height = 500;

let state = "game";
let wave = 1;

let player = {
    x: canvas.width/2,
    y: canvas.height/2,
    size: 32,
    speed: 3,
    health: 100,
    maxHealth: 100,
    damage: 1,
    slashCooldown: 0,
    slashRange: 60
};

let enemies = [];
let keys = {};

document.addEventListener("keydown", e => {
    keys[e.key] = true;

    if (state === "shop") {
        if (e.key === "1") buyUpgrade(0);
        if (e.key === "2") buyUpgrade(1);
        if (e.key === "3") buyUpgrade(2);
        if (e.key === "Enter") startNextWave();
    }
});

document.addEventListener("keyup", e => keys[e.key] = false);

function spawnWave() {
    for (let i = 0; i < wave + 2; i++) {
        let type = Math.random();

        if (type < 0.5) {
            enemies.push({
                x: Math.random()*canvas.width,
                y: Math.random()*canvas.height,
                size: 28,
                speed: 1.2,
                health: 3,
                type: "slime"
            });
        } else {
            enemies.push({
                x: Math.random()*canvas.width,
                y: Math.random()*canvas.height,
                size: 36,
                speed: 0.7,
                health: 6,
                type: "tank"
            });
        }
    }
}

spawnWave();

function autoSlash() {
    if (player.slashCooldown > 0) return;

    let hit = false;

    enemies.forEach((e, i) => {
        let dx = e.x - player.x;
        let dy = e.y - player.y;
        let dist = Math.sqrt(dx*dx + dy*dy);

        if (dist < player.slashRange) {
            e.health -= player.damage;
            hit = true;
            if (e.health <= 0) enemies.splice(i,1);
        }
    });

    if (hit) player.slashCooldown = 25;
}

function update() {

    if (state !== "game") return;

    if (keys["w"]) player.y -= player.speed;
    if (keys["s"]) player.y += player.speed;
    if (keys["a"]) player.x -= player.speed;
    if (keys["d"]) player.x += player.speed;

    player.x = Math.max(0, Math.min(canvas.width-player.size, player.x));
    player.y = Math.max(0, Math.min(canvas.height-player.size, player.y));

    autoSlash();

    if (player.slashCooldown > 0) player.slashCooldown--;

    enemies.forEach(e => {
        let dx = player.x - e.x;
        let dy = player.y - e.y;
        let dist = Math.sqrt(dx*dx + dy*dy);

        e.x += dx/dist * e.speed;
        e.y += dy/dist * e.speed;

        if (dist < e.size/2 + player.size/2) {
            player.health -= 0.2;
        }
    });

    if (enemies.length === 0) state = "shop";

    if (player.health <= 0) {
        alert("Game Over! Wave: " + wave);
        document.location.reload();
    }
}

function buyUpgrade(option) {
    if (option === 0) player.damage += 1;
    if (option === 1) player.speed += 0.5;
    if (option === 2) {
        player.maxHealth += 20;
        player.health = player.maxHealth;
    }
}

function startNextWave() {
    wave++;
    spawnWave();
    state = "game";
}

function drawPlayer(x,y) {
    ctx.fillStyle="#dcdcdc";
    ctx.fillRect(x+8,y,16,8);
    ctx.fillStyle="#ffffff";
    ctx.fillRect(x+4,y+8,24,16);
    ctx.fillStyle="#000000";
    ctx.fillRect(x+10,y+14,4,4);
    ctx.fillRect(x+18,y+14,4,4);
}

function drawSlime(x,y) {
    ctx.fillStyle="#00aa00";
    ctx.fillRect(x,y+8,28,20);
    ctx.fillStyle="#007700";
    ctx.fillRect(x+4,y+4,20,12);
}

function drawTank(x,y) {
    ctx.fillStyle="#880000";
    ctx.fillRect(x,y,36,36);
    ctx.fillStyle="#550000";
    ctx.fillRect(x+6,y+6,24,24);
}

function drawSlashEffect() {
    ctx.strokeStyle="#ffffff";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.arc(player.x+player.size/2, player.y+player.size/2, player.slashRange, 0, Math.PI*2);
    ctx.stroke();
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if (state === "game") {

        drawPlayer(player.x,player.y);

        enemies.forEach(e=>{
            if (e.type==="slime") drawSlime(e.x,e.y);
            else drawTank(e.x,e.y);
        });

        if (player.slashCooldown > 15) drawSlashEffect();

        ctx.fillStyle="red";
        ctx.fillRect(20,20,200,15);
        ctx.fillStyle="lime";
        ctx.fillRect(20,20,(player.health/player.maxHealth)*200,15);

        ctx.fillStyle="white";
        ctx.font="16px monospace";
        ctx.fillText("Wave: "+wave,20,60);
        ctx.fillText("Damage: "+player.damage,20,80);
    }

    else if (state==="shop") {
        ctx.fillStyle="white";
        ctx.font="20px monospace";
        ctx.fillText("SHOP - Wave Cleared!",280,150);
        ctx.fillText("1: +1 Damage",300,220);
        ctx.fillText("2: +Speed",300,260);
        ctx.fillText("3: +20 Max HP",300,300);
        ctx.fillText("Press ENTER to continue",250,360);
    }
}

function gameLoop(){
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
