<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Arcane Arena</title>
<style>
body { margin:0; overflow:hidden; background:#0c0f1a; font-family:monospace; }
canvas { display:block; image-rendering: pixelated; }
#ui { position:absolute; top:10px; left:50%; transform:translateX(-50%); width:400px; }
.bar { height:18px; background:#222; margin-bottom:6px; border:2px solid #000; }
#hpFill { height:100%; background:#00cc44; width:100%; }
#expFill { height:100%; background:#0066ff; width:0%; }
#statMenu, #mainMenu { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
 background:#1a1f2e; padding:20px; border:4px solid #3a4a7a; display:none; color:white; width:320px; }
button { background:#2a3a6a; color:white; border:none; padding:8px; margin:5px 0; width:100%; cursor:pointer; }
button:hover { background:#3f5bb5; }
#title { font-size:32px; text-align:center; margin-bottom:20px; animation:pulse 2s infinite alternate; }
@keyframes pulse { from { text-shadow:0 0 10px #4488ff; } to { text-shadow:0 0 25px #88ccff; } }
</style>
</head>
<body>
<canvas id="game"></canvas>

<div id="ui">
 <div class="bar"><div id="hpFill"></div></div>
 <div class="bar"><div id="expFill"></div></div>
</div>

<div id="mainMenu">
 <div id="title">ARCANE ARENA</div>
 <button onclick="startGame()">Start Game</button>
</div>

<div id="statMenu">
 <h3>Level Up! (Points: <span id="points">0</span>)</h3>
 <button onclick="upgrade('damage')">Damage (<span id="dmgStat">1</span>)</button>
 <button onclick="upgrade('speed')">Speed (<span id="spdStat">2</span>)</button>
 <button onclick="upgrade('rate')">Fire Rate (<span id="rateStat">600</span>)</button>
 <button onclick="closeStats()">Resume</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let gameRunning=false, paused=false;
let keys={}, player, enemies=[], bullets=[], particles=[];
let wave=1, expToLevel=50;

// Enemy types with unique visual properties
const ENEMY_TYPES=[
 {name:"slime", color:"#3cff5a", size:22, hp:40, speed:1, exp:15},
 {name:"beast", color:"#aa6622", size:28, hp:70, speed:1.5, exp:35},
 {name:"ghost", color:"#8888ff", size:24, hp:50, speed:2, exp:30},
 {name:"demon", color:"#aa0000", size:32, hp:90, speed:0.8, exp:60},
 {name:"wisp", color:"#ff88ff", size:16, hp:25, speed:2.5, exp:20}
];

const mainMenu=document.getElementById("mainMenu");
const statMenu=document.getElementById("statMenu");
mainMenu.style.display="block";

function startGame(){
 mainMenu.style.display="none";
 gameRunning=true;
 init();
 loop();
}

function init(){
 player={
  x:0, y:0, size:24,
  hp:100,maxHp:100,
  exp:0,level:1,points:0,
  damage:10,speed:2.5,fireRate:600,
  lastShot:0,anim:0
 };
 enemies=[]; bullets=[]; particles=[];
 spawnWave();
}

function spawnWave(){
 for(let i=0;i<wave*5;i++){
  const t=ENEMY_TYPES[Math.floor(Math.random()*ENEMY_TYPES.length)];
  enemies.push({
   x:(Math.random()-0.5)*1500,
   y:(Math.random()-0.5)*1500,
   type:t.name,
   color:t.color,
   size:t.size,
   hp:t.hp+wave*10,
   maxHp:t.hp+wave*10,
   speed:t.speed+wave*0.05,
   exp:t.exp
  });
 }
}

function loop(){
 if(!gameRunning)return;
 requestAnimationFrame(loop);
 if(paused)return;
 update(); draw();
}

document.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

function update(){
 player.anim+=0.1;

 if(keys["w"]) player.y-=player.speed;
 if(keys["s"]) player.y+=player.speed;
 if(keys["a"]) player.x-=player.speed;
 if(keys["d"]) player.x+=player.speed;

 autoAim();

 enemies.forEach(e=>{
  const dx=player.x-e.x, dy=player.y-e.y;
  const dist=Math.hypot(dx,dy);
  e.x+=dx/dist*e.speed;
  e.y+=dy/dist*e.speed;

  if(dist<20) player.hp-=0.2;

  if(e.hp<e.maxHp && !e.showHP){ e.showHP=60; }
  if(e.showHP>0) e.showHP--;
 });

 bullets.forEach(b=>{
  b.x+=b.dx; b.y+=b.dy;
  enemies.forEach(e=>{
   const dist=Math.hypot(b.x-e.x,b.y-e.y);
   if(dist<e.size){
    e.hp-=player.damage;
    e.showHP=60;
    b.dead=true;
    if(e.hp<=0){
     player.exp+=e.exp;
     enemies.splice(enemies.indexOf(e),1);
     if(enemies.length===0){ wave++; spawnWave(); }
    }
   }
  });
  particles.push({x:b.x,y:b.y,life:20});
 });
 bullets=bullets.filter(b=>!b.dead);
 particles.forEach(p=>p.life--);
 particles=particles.filter(p=>p.life>0);

 if(player.exp>=expToLevel){
  player.exp-=expToLevel;
  player.level++;
  player.points+=3;
  expToLevel+=30;
  openStats();
 }

 document.getElementById("hpFill").style.width=(player.hp/player.maxHp*100)+"%";
 document.getElementById("expFill").style.width=(player.exp/expToLevel*100)+"%";
}

// Auto-aim shooting
function autoAim(){
 if(Date.now()-player.lastShot<player.fireRate) return;
 if(enemies.length===0) return;
 const closest=enemies.reduce((a,b)=>Math.hypot(player.x-a.x,player.y-a.y)<Math.hypot(player.x-b.x,player.y-b.y)?a:b);
 const dx=closest.x-player.x, dy=closest.y-player.y;
 const dist=Math.hypot(dx,dy);
 bullets.push({x:player.x,y:player.y,dx:dx/dist*6,dy:dy/dist*6});
 player.lastShot=Date.now();
}

// Draw everything
function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.save();
 ctx.translate(canvas.width/2-player.x,canvas.height/2-player.y);
 drawBackground();

 // particles
 particles.forEach(p=>{
  ctx.fillStyle="rgba(100,150,255,"+(p.life/20)+")";
  ctx.fillRect(p.x,p.y,4,4);
 });

 // bullets
 bullets.forEach(b=>{
  ctx.fillStyle="#66ccff";
  ctx.beginPath(); ctx.arc(b.x,b.y,6,0,Math.PI*2); ctx.fill();
 });

 // enemies
 enemies.forEach(e=>{
  drawEnemy(e);
 });

 drawPlayer();
 ctx.restore();
}

function drawPlayer(){
 const walk=Math.sin(player.anim)*2;
 // legs
 ctx.fillStyle="#333";
 ctx.fillRect(player.x-6,player.y+6+walk,6,12);
 ctx.fillRect(player.x,player.y+6-walk,6,12);
 // body
 ctx.fillStyle="#2c5aa0";
 ctx.fillRect(player.x-8,player.y-12,16,18);
 // head
 ctx.fillStyle="#f1c27d";
 ctx.fillRect(player.x-6,player.y-20,12,12);
 // hair
 ctx.fillStyle="#4b2e19";
 ctx.fillRect(player.x-6,player.y-20,12,4);
 // staff
 ctx.fillStyle="#8b5a2b";
 ctx.fillRect(player.x+8,player.y-8,4,24);
 ctx.fillStyle="#00ccff";
 ctx.fillRect(player.x+6,player.y-12,8,4);
}

function drawEnemy(e){
 const bounce=Math.sin(Date.now()*0.005*e.speed)*2;
 ctx.fillStyle=e.color;
 ctx.fillRect(e.x-e.size/2,e.y-e.size/2+bounce,e.size,e.size);
 if(e.showHP>0){
  ctx.fillStyle="red";
  ctx.fillRect(e.x-e.size/2,e.y-e.size/2-6,e.size*(e.hp/e.maxHp),4);
 }
}

function drawBackground(){
 for(let x=-2000;x<2000;x+=64){
  for(let y=-2000;y<2000;y+=64){
   ctx.fillStyle=((x+y)/64)%2?"#1a253f":"#152033";
   ctx.fillRect(x,y,64,64);
  }
 }
}

// Stat Menu
function openStats(){
 paused=true;
 statMenu.style.display="block";
 updateStatUI();
}
function closeStats(){ paused=false; statMenu.style.display="none"; }
function upgrade(stat){
 if(player.points<=0) return;
 if(stat==="damage") player.damage+=5;
 if(stat==="speed"){
  player.speed+=0.5;
  if(player.speed>10) player.speed+=player.speed/2; // if extreme
 }
 if(stat==="rate"){
  player.fireRate=Math.max(50,player.fireRate-50);
  if(player.fireRate<300) player.fireRate/=2;
 }
 player.points--;
 updateStatUI();
}
function updateStatUI(){
 document.getElementById("points").innerText=player.points;
 document.getElementById("dmgStat").innerText=player.damage;
 document.getElementById("spdStat").innerText=player.speed.toFixed(1);
 document.getElementById("rateStat").innerText=Math.floor(player.fireRate);
}

</script>
</body>
</html>
